function AminoglycosidePharmacokineticsViewModel(){function e(e,t){var i=moment(ko.utils.unwrapObservable(e),n),r=moment(ko.utils.unwrapObservable(t),n);return r.isBefore(i)&&r.add("days",1),moment.duration(r.diff(i))}function t(t,i){return e(t,i).asHours()}var i=this,n="HH:mm",r=0,o=1,s=1,a=1,u=2,d=3;this.modes=["Initial","Peak-Trough","Zaske"],this.sexes=["Female","Male"],this.medications=["Gentamicin","Tobramycin","Amikacin"],this.mode=ko.observable(i.modes[0]),this.age=ko.observable(30).extend({numericSet:0}),this.sex=ko.observable(i.sexes[0]),this.height=ko.observable(66).extend({numericSet:0}),this.weight=ko.observable(70).extend({numericSet:s}),this.dosingWeight=ko.observable(60).extend({numericSet:s}),this.serumCreatinine=ko.observable(.7).extend({numericSet:2}),this.inputVolumeOfDistribution=ko.observable(.25).extend({numericSet:2}),this.idealWeight=ko.computed(function(){var e;switch(i.sex()){case"Female":e=45.5;break;case"Male":e=50;break;default:return 0/0}return e+2.3*(i.height()-60)}),this.displayIdealWeight=this.idealWeight.extend({numericGet:s}),this.adjustedWeight=ko.computed(function(){return.6*i.idealWeight()+.4*i.weight()}),this.displayAdjustedWeight=this.adjustedWeight.extend({numericGet:s}),this.dosingWeightStatus=ko.computed(function(){return i.weight()<i.idealWeight()?"DosingWeightShouldBeActualWeight":i.weight()<1.2*i.idealWeight()?"DosingWeightShouldBeIdealWeight":"DosingWeightShouldBeAdjustedWeight"}),this.creatinineClearance=ko.computed(function(){var e;switch(i.sex()){case"Female":e=.85;break;case"Male":e=1;break;default:return 0/0}return(140-i.age())*i.dosingWeight()/72/Math.max(.7,i.serumCreatinine())}),this.displayCreatinineClearance=this.creatinineClearance.extend({numericGet:-1}),this.medication=ko.observable(i.medications[0]),this.dose=ko.observable(560).extend({numericSet:r}),this.interval=ko.observable(24).extend({numericSet:o}),this.start=ko.observable("09:00").extend({momentSet:n}),this.end=ko.observable("10:00").extend({momentSet:n}),this.dosePerWeight=ko.computed(function(){return i.dose()/i.weight()}),this.displayDosePerWeight=this.dosePerWeight.extend({numericGet:a}),this.dosePerIdealWeight=ko.computed(function(){return i.dose()/i.idealWeight()}),this.displayDosePerIdealWeight=this.dosePerIdealWeight.extend({numericGet:a}),this.dosePerAdjustedWeight=ko.computed(function(){return i.dose()/i.adjustedWeight()}),this.displayDosePerAdjustedWeight=this.dosePerAdjustedWeight.extend({numericGet:a}),this.dosePerDosingWeight=ko.computed(function(){return i.dose()/i.dosingWeight()}),this.displayDosePerDosingWeight=this.dosePerDosingWeight.extend({numericGet:a}),this.levelFloor=ko.computed(function(){switch(i.medication()){case"Gentamicin":case"Tobramycin":return 1;case"Amikacin":return 4}}),this.displayLevelFloor=this.levelFloor.extend({numericGet:0}),this.troughLevelTime=ko.observable("08:00").extend({momentSet:n}),this.troughLevelValue=ko.observable(.05).extend({numericSet:u,numericMinimum:.01}),this.firstLevelTime=ko.observable("11:00").extend({momentSet:n}),this.firstLevelValue=ko.observable(9).extend({numericSet:u}),this.secondLevelTime=ko.observable("21:00").extend({momentSet:n}),this.secondLevelValue=ko.observable(.6).extend({numericSet:u}),this.volumeOfDistribution=ko.computed(function(){switch(i.mode()){case"Initial":return i.inputVolumeOfDistribution();case"Peak-Trough":case"Zaske":return i.clearance()/i.firstOrderDispositionRate()/i.weight()}}),this.displayVolumeOfDistribution=this.volumeOfDistribution.extend({numericGet:d}),this.infusionTimeInHours=ko.computed(function(){return t(i.start,i.end)}),this.displayInfusionTimeInHours=this.infusionTimeInHours.extend({numericGet:o}),this.clearance=ko.computed(function(){switch(i.mode()){case"Initial":return.0036*i.dosingWeight()+.0438*i.creatinineClearance();case"Peak-Trough":return i.dose()*(1-Math.exp(-i.firstOrderDispositionRate()*i.infusionTimeInHours()))*Math.exp(-i.firstOrderDispositionRate()*t(i.end,i.firstLevelTime))/i.infusionTimeInHours()/i.firstLevelValue()/(1-Math.exp(-i.firstOrderDispositionRate()*i.interval()));case"Zaske":var e=t(i.troughLevelTime,i.start);return i.dose()*(1-Math.exp(-i.firstOrderDispositionRate()*i.infusionTimeInHours()))/i.infusionTimeInHours()/(i.calculatedPeak()-i.troughLevelValue()*Math.exp(-i.firstOrderDispositionRate()*(i.infusionTimeInHours()+e)))}}),this.displayClearance=this.clearance.extend({numericGet:d}),this.firstOrderDispositionRate=ko.computed(function(){switch(i.mode()){case"Initial":return i.clearance()/i.volumeOfDistribution()/i.dosingWeight();case"Peak-Trough":return Math.log(i.firstLevelValue()/i.troughLevelValue())/(i.interval()-t(i.troughLevelTime,i.firstLevelTime));case"Zaske":return Math.log(i.firstLevelValue()/i.secondLevelValue())/t(i.firstLevelTime,i.secondLevelTime)}}),this.displayFirstOrderDispositionRate=this.firstOrderDispositionRate.extend({numericGet:d}),this.halflife=ko.computed(function(){return Math.log(2)/i.firstOrderDispositionRate()}),this.displayHalflife=this.halflife.extend({numericGet:o}),this.calculatedPeak=ko.computed(function(){return i.firstLevelValue()*Math.exp(i.firstOrderDispositionRate()*t(i.end,i.firstLevelTime))}),this.displayCalculatedPeak=this.calculatedPeak.extend({numericGet:u}),this.desiredPeak=ko.observable(30).extend({numericSet:u}),this.desiredTrough=ko.observable(.5).extend({numericSet:u}),this.newInfusionDuration=ko.observable(1).extend({numericSet:o}),this.bestLoadingDose=ko.computed(function(){return i.desiredPeak()*i.clearance()*i.newInfusionDuration()/(1-Math.exp(-i.firstOrderDispositionRate()*i.newInfusionDuration()))}),this.displayBestLoadingDose=this.bestLoadingDose.extend({numericGet:r}),this.bestLoadingDosePerWeight=ko.computed(function(){return i.bestLoadingDose()/i.weight()}),this.displayBestLoadingDosePerWeight=this.bestLoadingDosePerWeight.extend({numericGet:a}),this.bestLoadingDosePerIdealWeight=ko.computed(function(){return i.bestLoadingDose()/i.idealWeight()}),this.displayBestLoadingDosePerIdealWeight=this.bestLoadingDosePerIdealWeight.extend({numericGet:a}),this.bestLoadingDosePerAdjustedWeight=ko.computed(function(){return i.bestLoadingDose()/i.adjustedWeight()}),this.displayBestLoadingDosePerAdjustedWeight=this.bestLoadingDosePerAdjustedWeight.extend({numericGet:a}),this.bestLoadingDosePerDosingWeight=ko.computed(function(){return i.bestLoadingDose()/i.dosingWeight()}),this.displayBestLoadingDosePerDosingWeight=this.bestLoadingDosePerDosingWeight.extend({numericGet:a}),this.bestInterval=ko.computed(function(){return Math.log(i.desiredPeak()/i.desiredTrough())/i.firstOrderDispositionRate()+i.infusionTimeInHours()}),this.displayBestInterval=this.bestInterval.extend({numericGet:o}),this.newInterval=ko.observable(24).extend({numericSet:o}),this.bestMaintenanceDose=ko.computed(function(){return i.bestLoadingDose()*(1-Math.exp(-i.firstOrderDispositionRate()*i.newInterval()))}),this.displayBestMaintenanceDose=this.bestMaintenanceDose.extend({numericGet:r}),this.bestMaintenanceDosePerWeight=ko.computed(function(){return i.bestMaintenanceDose()/i.weight()}),this.displayBestMaintenanceDosePerWeight=this.bestMaintenanceDosePerWeight.extend({numericGet:a}),this.bestMaintenanceDosePerIdealWeight=ko.computed(function(){return i.bestMaintenanceDose()/i.idealWeight()}),this.displayBestMaintenanceDosePerIdealWeight=this.bestMaintenanceDosePerIdealWeight.extend({numericGet:a}),this.bestMaintenanceDosePerAdjustedWeight=ko.computed(function(){return i.bestMaintenanceDose()/i.adjustedWeight()}),this.displayBestMaintenanceDosePerAdjustedWeight=this.bestMaintenanceDosePerAdjustedWeight.extend({numericGet:a}),this.bestMaintenanceDosePerDosingWeight=ko.computed(function(){return i.bestMaintenanceDose()/i.dosingWeight()}),this.displayBestMaintenanceDosePerDosingWeight=this.bestMaintenanceDosePerDosingWeight.extend({numericGet:a}),this.hypotheticalDose=ko.observable(650).extend({numericSet:r}),this.hypotheticalDosePerWeight=ko.computed(function(){return i.hypotheticalDose()/i.weight()}),this.displayHypotheticalDosePerWeight=this.hypotheticalDosePerWeight.extend({numericGet:a}),this.hypotheticalDosePerIdealWeight=ko.computed(function(){return i.hypotheticalDose()/i.idealWeight()}),this.displayHypotheticalDosePerIdealWeight=this.hypotheticalDosePerIdealWeight.extend({numericGet:a}),this.hypotheticalDosePerAdjustedWeight=ko.computed(function(){return i.hypotheticalDose()/i.adjustedWeight()}),this.displayHypotheticalDosePerAdjustedWeight=this.hypotheticalDosePerAdjustedWeight.extend({numericGet:a}),this.hypotheticalDosePerDosingWeight=ko.computed(function(){return i.hypotheticalDose()/i.dosingWeight()}),this.displayHypotheticalDosePerDosingWeight=this.hypotheticalDosePerDosingWeight.extend({numericGet:a}),this.hypotheticalInterval=ko.observable(24).extend({numericSet:o}),this.predictedPeak=ko.computed(function(){return i.hypotheticalDose()*(1-Math.exp(-i.firstOrderDispositionRate()*i.newInfusionDuration()))/i.newInfusionDuration()/i.clearance()/(1-Math.exp(-i.firstOrderDispositionRate()*i.hypotheticalInterval()))}),this.displayPredictedPeak=this.predictedPeak.extend({numericGet:u}),this.predictedTrough=ko.computed(function(){return i.predictedPeak()*Math.exp(-i.firstOrderDispositionRate()*(i.hypotheticalInterval()-i.newInfusionDuration()))}),this.displayPredictedTrough=this.predictedTrough.extend({numericGet:u}),this.predictedDurationUnderLevelFloor=ko.computed(function(){return i.hypotheticalInterval()-i.newInfusionDuration()-Math.log(i.predictedPeak()/i.levelFloor())/i.firstOrderDispositionRate()}),this.displayPredictedDurationUnderLevelFloor=this.predictedDurationUnderLevelFloor.extend({numericGet:u}),this.bodyClasses=ko.computed(function(){return[i.mode().replace(/[- &]/g,"")+"Mode",i.dosingWeightStatus()].join(" ")}),function(){function e(e){var t={};for(var i in e)if(e.hasOwnProperty(i)){if(t.hasOwnProperty(e[i]))throw'invertObject() called on non-invertible object; repeated value was "'+e[i]+'"';t[e[i]]=i}return t}var t="value: ",n="&",r="=",o={mode:"m",age:"a",sex:"sx",height:"h",weight:"w",dosingWeight:"dw",serumCreatinine:"SCr",inputVolumeOfDistribution:"Vd",medication:"med",dose:"d",interval:"i",start:"s",end:"e",troughLevelTime:"tt",troughLevelValue:"tv",firstLevelTime:"1t",firstLevelValue:"1v",secondLevelTime:"2t",secondLevelValue:"2v",desiredPeak:"dp",desiredTrough:"dt",newInfusionDuration:"nit",newInterval:"ni",hypotheticalDose:"hd",hypotheticalInterval:"hi",Initial:"I","Peak-Trough":"PT",Zaske:"Z",Female:"F",Male:"M",Gentamicin:"G",Tobramycin:"T",Amikacin:"A"},s=e(o),a=ko.observable();i.forceHashRefresh=function(){a.notifySubscribers()},i.hash=ko.computed({read:function(){var e=i.bodyClasses();e=a();var s=$("input, select, textarea","#ValueBlocks").filter(":visible").map(function(){return $(this).attr("data-bind")}).get(),u=s.map(function(e){var i=e.split(",").map(function(e){return e.trim()}).filter(function(e){return e.startsWith(t)});switch(i.length){case 0:throw"no value parts in data-bind attribute";case 1:return i[0].substr(t.length);default:throw'multiple value parts in data-bind attribute { "'+i.join('", "')+'" }'}}),d=u.map(function(e){var t=o[e]||e,n=ko.utils.unwrapObservable(i[e]),s=o[n]||n;return t+r+s}).join(n);return d},write:function(e){var t=e.startsWith("#")?e.substr(1):e,o=t.split(n);if(1!=o.length||0!=o[0].length)for(var a in o){var u=o[a],d=u.split(r);if(2==d.length){var h=s[d[0]]||d[0],c=s[d[1]]||d[1];i[h](c)}else console.log('Could not parse hash part "'+u+'"')}}}),i.displayHash=ko.computed(function(){return i.hash().split("&").join("&amp;&#8203;")})}()}!function(){function e(e,t){var i=parseFloat(+e),n=Math.pow(10,t);return Math.round(i*n)/n}Array.prototype.filter||(Array.prototype.filter=function(e){"use strict";if(void 0===this||null===this)throw new TypeError;var t=Object(this),i=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var n=[],r=arguments.length>=2?arguments[1]:void 0,o=0;i>o;o++)if(o in t){var s=t[o];e.call(r,s,o,t)&&n.push(s)}return n}),Array.prototype.map||(Array.prototype.map=function(e,t){var i,n,r;if(null==this)throw new TypeError(" this is null or not defined");var o=Object(this),s=o.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(i=t),n=new Array(s),r=0;s>r;){var a,u;r in o&&(a=o[r],u=e.call(i,a,r,o),n[r]=u),r++}return n}),String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{enumerable:!1,configurable:!1,writable:!1,value:function(e,t){return t=t||0,this.indexOf(e,t)===t}}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),ko.extenders.logChanges=function(e,t){return e.subscribe(function(e){console.log(t+" -> "+e)}),e},ko.extenders.numericGet=function(t,i){return ko.computed({read:function(){var n=e(t(),i);return i>=0?n.toFixed(i):n}})},ko.extenders.numericSet=function(t,i){var n=ko.computed({read:t,write:function(n){var r=!1,o=t();if(!isNaN(n)){var s=e(n,i);r=s!==o,r&&t(s)}n===o||r||t.notifySubscribers(o)}}).extend({notify:"always"});return n(t()),n},ko.extenders.numericMinimum=function(e,t){var i=ko.computed({read:e,write:function(i){var n=!1,r=e();if(!isNaN(i)){var o=t>i?t:i;n=o!==r,n&&e(o)}i===r||n||e.notifySubscribers(r)}}).extend({notify:"always"});return i(e()),i},ko.extenders.momentSet=function(e,t){var i=ko.computed({read:e,write:function(i){var n=moment(i,t);n.isValid()?e(n.format(t)):e.notifySubscribers(e())}}).extend({notify:"always"});return i(e()),i}}(),function(){function e(e,t){var i=parseFloat(+e),n=Math.pow(10,t);return Math.round(i*n)/n}ko.extenders.logChanges=function(e,t){return e.subscribe(function(e){console.log(t+" -> "+e)}),e},ko.extenders.numericGet=function(t,i){return ko.computed({read:function(){var n=e(t(),i);return i>=0?n.toFixed(i):n}})},ko.extenders.numericSet=function(t,i){var n=ko.computed({read:t,write:function(n){var r=!1,o=t();if(!isNaN(n)){var s=e(n,i);r=s!==o,r&&t(s)}n===o||r||t.notifySubscribers(o)}}).extend({notify:"always"});return n(t()),n},ko.extenders.numericMinimum=function(e,t){var i=ko.computed({read:e,write:function(i){var n=!1,r=e();if(!isNaN(i)){var o=t>i?t:i;n=o!==r,n&&e(o)}i===r||n||e.notifySubscribers(r)}}).extend({notify:"always"});return i(e()),i},ko.extenders.momentSet=function(e,t){var i=ko.computed({read:e,write:function(i){var n=moment(i,t);n.isValid()?e(n.format(t)):e.notifySubscribers(e())}}).extend({notify:"always"});return i(e()),i}}(),$(document).ready(function(){$("input, select, textarea").after(function(){var e=$(this).attr("data-bind").replace("value","text").replace(/options[:] \w+[,] /,"");return'<span class="InputPrint" data-bind="'+e+'"></span>'});var e=new AminoglycosidePharmacokineticsViewModel;hasher.changed.add(e.hash),hasher.initialized.add(e.hash),hasher.init(),ko.applyBindings(e),e.hash.subscribe(function(e){hasher.changed.active=!1,hasher.setHash(e),hasher.changed.active=!0,$("#QRCode").qrcode({render:"canvas",width:200,height:200,text:window.location.href})}),e.forceHashRefresh(),$("input, select, textarea").addClass("Untouched").on("blur.TouchTracking change.TouchTracking keypress.TouchTracking paste.TouchTracking",function(){$(this).removeClass("Untouched").off("blur.TouchTracking change.TouchTracking keypress.TouchTracking paste.TouchTracking")}),$("input.TimeInput").timepicker({timeFormat:"HH:mm",timeOnlyTitle:"",showTime:!1,currentText:"",hourGrid:2,minuteGrid:5,beforeShow:function(e,t){setTimeout(function(){t.dpDiv.position({my:"center top",at:"center bottom+3px",of:e,collision:"fit flipfit"})})}})});